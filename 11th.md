### Congestion detection
By detecting packet loss, we can detect congestion.

**Retransmission Timeout**
If an ACK for the transmitted segment is not received within the designated time frame, consider it a packet loss.

- Configuration of the timeout interval: it is calculated based on the RTT of the segment.
    - Timeout interval < RTT => Unreasonable retransmission.
    - Timeout interval >> RTT => degrades performance.

RTT depends on each connection and may vary over time.

**Estimating RTT**
- RTT: The time between handing a segment to the network layer (IP) and receiving it
    - MRTT: Measured RTT
    - ERTT: Estimated RTT. The following update rule (exponentially weighted average) is often utilized:
$$
	ext{ERTT} \longleftarrow (1-\alpha)\text{ERTT} + \alpha\text{MRTT}
$$
    - $\alpha=\frac{1}{8}$ for many implementations.
    - Retransmitted packets are excluded from the measurement.

- DevRTT: Variability of RTT, updated by the following rule:
$$
	ext{DevRTT} \longleftarrow (1-\beta)\text{DevRTT} + \beta |\text{MRTT}-\text{ERTT}|
$$
    - $\beta=\frac{1}{4}$ is used in many implementations.

- **RTO**
$$
	ext{RTO} = \text{ERTT} + 4\text{DevRTT}
$$
If RTT follows a Gaussian distribution, $\text{Pr}(\text{RTT}>\text{RTO}) \simeq 3.17 \times 10^{-5}$. In some cases, implementations "double the timeout interval for retransmitting a packet." 

**Fast retransmission**
In many cases, RTO is much larger than RTT. => It takes a long time to detect packet loss because of the retransmission timeout.

In fast retransmission, due to **duplicate ACKs**, we can detect congestion early.
- If we receive three duplicate ACKs for a segment, without waiting for the timeout, we retransmit the segment whose ACK was not received.

**TCP Tahoe**
- Increasing window: slow start + congestion avoidance.
- Congestion detection: Retransmission timeout + fast retransmission.
- If congestion is detected, set
$$\text{ssthresh} \leftarrow \frac{1}{2} \text{cwnd},\\ \text{cwnd} \leftarrow 1$$


**Fast recovery**
If fast retransmission occurs, at least three successive segments are received by the receiver side. => congestion is not fatal, so setting $\text{cwnd}\leftarrow 1$ is inefficient.

- Fast recovery: avoid extreme degradation of throughput.
    1. After receiving the third duplicate ACK, set $\text{ssthresh}\leftarrow \frac{1}{2} \cdot \text{cwnd} $ and retransmit. After that, set $\text{cwnd}\leftarrow \text{ssthresh} + 3\text{MSS}$.

    2. After each reception of a duplicate ACK, update as $\text{cwnd}\leftarrow\text{cwnd}+\text{MSS}$.

    3. If an ACK is received for the previously unacknowledged segment (update ACK number), update as $\text{cwnd}\leftarrow\text{ssthresh}$

**TCP Reno**
- Increasing window size: slow start + congestion avoidance
- Congestion detection: retransmission timeout + fast retransmission
- If congestion is detected, resume with fast recovery.
- In the case of a retransmission timeout, resume with $\text{cwnd}=1$.



AIMD (Additive-increase/Multiplicative-decrease)
- AI for congestion avoidance mode
- If three duplicate ACKs are received, multiplicative decrease is employed
# Congestion control
## The principle of congestion control
- Congestion: The situation where too many packets exist in a network.
    - When the number of transmitted packets is less than what the network can handle => Delivered packet number (throughput) is the same as the transmitted packet number.
    - When the number of transmitted packets is more than the network capability => Retransmitted packets make the congestion status worse and thus throughput decreases.

- An ideal congestion control
    - Situation where there are NOT too many packets => Throughput increases linearly as packets increase.

    - Situation where there are many packets => Throughput stays within the network capacity.

## Congestion control by TCP
- **Window control**: Each client can transmit packets up to designated window size.

- **Bandwidth Delay Product (BDP)**
$$ \text{BDP} = \text{BW} \times \text{RTT} $$
    - BW : The minimum transmission speed of links on a path.
    - RTT : Round trip time

- If the window size is smaller than the BDP, the transmission path is not sufficiently used.

**Requirements for TCP congestion control**
- Increase the window size quickly up to the BDP
- When congestion occurs, do not let the window size become too small compared to the BDP.

### Window size control
- Congestion window: The maximum byte size that can be transmitted without waiting for an ACK for a previous packet.

- Distinguish two domains using ssthresh.
    - $\text{cwnd} < \text{ssthresh}$ : **slow start** mode.
    - $\text{cwnd} \geq \text{ssthresh}$ : **congestion avoidance** mode.

1. While $\text{cwnd} < \text{ssthresh}$, $\text{cwnd}$ increases exponentially.
2. After it becomes $\text{cwnd} \geq \text{ssthresh}$, $\text{cwnd}$ increases linearly.
3. Once congestion is detected, $\text{cwnd}$ decreases.
    - Loss detection via timeout
    - Loss detection via multiple (more than three) ACK receptions.

**Slow start**
After connection establishment, do slow start first (increase $\text{cwnd}$ quickly).
- The initial value of $\text{cwnd}$ is 1 maximum segment size (MSS)
- After each ACK reception, increment $\text{cwnd}$ by 1 $\text{cwnd}$.

**Congestion avoidance**
Increase rate gradually as ACKs are received.
- Once an ACK is received,
$$\text{cwnd} \longleftarrow \text{cwnd} + \frac{\text{MSS}}{\text{cwnd}} \times \text{MSS}$$

- Transmission rate increases linearly.